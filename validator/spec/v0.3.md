# Agent Manifest Specification v0.3

**Status:** Draft
**Date:** 2026-02-19
**Authors:** Brandon Weber (brandon@agent-manifest.com)
**License:** CC0 1.0 Universal (Public Domain Dedication)
**Previous Version:** [v0.2](./v0.2.md)

---

## Table of Contents

1. [Introduction](#1-introduction)
2. [Conventions](#2-conventions)
3. [Manifest Location and Retrieval](#3-manifest-location-and-retrieval)
4. [Manifest Schema](#4-manifest-schema)
5. [Identity Fields](#5-identity-fields)
6. [Categorization](#6-categorization)
7. [Endpoints](#7-endpoints)
8. [Authentication](#8-authentication)
9. [Pricing (Informational)](#9-pricing-informational)
10. [Payment](#10-payment)
11. [Agent Payment Credentials](#11-agent-payment-credentials)
12. [Payment Onboarding Flow](#12-payment-onboarding-flow)
13. [Budget Enforcement Headers](#13-budget-enforcement-headers)
14. [The 402 Payment Required Response](#14-the-402-payment-required-response)
15. [Reliability](#15-reliability)
16. [Agent Notes](#16-agent-notes)
17. [Agent Operational Completeness](#17-agent-operational-completeness)
18. [Validation](#18-validation)
19. [Registry](#19-registry)
20. [Security Considerations](#20-security-considerations)
21. [Complete Manifest Examples](#21-complete-manifest-examples)
22. [Changelog: v0.2 → v0.3](#22-changelog-v02--v03)
23. [Migration Guide: v0.2 → v0.3](#23-migration-guide-v02--v03)

---

## 1. Introduction

The Agent Manifest Protocol (AMP) is an open protocol that enables autonomous AI agents to discover, evaluate, authenticate against, and compensate data APIs at runtime without human configuration.

Every AMP-compliant API publishes a machine-readable manifest at a well-known location. This manifest describes the API's identity, capabilities, economics, operational requirements, and — as of v0.3 — its executable payment flows.

**v0.3** extends the protocol with the **Autonomous Payment Extension**: a set of schemas, flows, and conventions that allow AI agents to negotiate payment terms, establish billing relationships, and manage spend — all without human interaction at runtime.

### 1.1 Design Principles

1. **Protocol, not platform.** AMP defines flows and schemas. It does not mandate any specific payment provider, settlement system, or credential issuer.
2. **Provider-agnostic naming.** Field names and enum values use generic concepts (`settlement_provider`, `metered`, `prepaid`) — never provider-specific terminology.
3. **Autonomous-first.** Every flow defined in this specification MUST be executable by a software agent with zero human interaction at runtime. Steps requiring a browser, CAPTCHA, or human approval are out of scope or belong in a separate pre-provisioning phase.
4. **Progressive complexity.** Free APIs declare `"payment": null`. Simple paid APIs declare a rate and an onboarding endpoint. Complex APIs can declare tiered pricing, multiple units, and budget negotiation.
5. **Backward compatible.** v0.3 manifests are parseable by v0.2 consumers without breaking. New fields are additive.
6. **Security by default.** Agent credentials carry spending authority. The spec defines how agents present authorization, how APIs verify it, and how budget limits are enforced.

### 1.2 Scope

This specification defines:

- The schema for `agent-manifest.json`
- The payment object and its subfields
- The agent payment credential format
- The payment onboarding protocol
- Budget enforcement headers
- The 402 Payment Required response schema
- Validation rules for all of the above

This specification does **not** define:

- Any specific payment provider integration
- Credential issuance platforms
- Settlement infrastructure
- Agent architectures or orchestration patterns

---

## 2. Conventions

The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in [RFC 2119](https://www.rfc-editor.org/rfc/rfc2119).

All JSON examples in this specification are informative unless explicitly marked as normative.

---

## 3. Manifest Location and Retrieval

Every AMP-compliant API MUST serve a valid manifest at:

```
/.well-known/agent-manifest.json
```

The manifest MUST be served over HTTPS. The response MUST return HTTP 200 with `Content-Type: application/json`. The document MUST be valid JSON.

---

## 4. Manifest Schema

The v0.3 manifest extends v0.2 with one new top-level field: `payment`. All v0.2 fields remain valid and retain their semantics.

### 4.1 Top-Level Fields

| Field | Type | Required | Description |
|---|---|---|---|
| `spec_version` | string | REQUIRED | MUST be `"agentmanifest-0.3"` |
| `name` | string | REQUIRED | Human-readable API name. 3–100 characters. |
| `version` | string | REQUIRED | Semantic version of the API (e.g., `"1.0.0"`). |
| `description` | string | REQUIRED | What the API does. Minimum 100 characters. |
| `homepage` | string (URL) | OPTIONAL | URL to the API's homepage. |
| `documentation` | string (URL) | OPTIONAL | URL to external documentation. |
| `categories` | array of strings | REQUIRED | One or more domain categories from the controlled vocabulary (§6.1). |
| `primary_category` | string | REQUIRED | Functional classification. One of: `reference`, `live`, `computational`, `transactional`, `enrichment`, `personal`, `discovery`. See §6.2. |
| `endpoints` | array of objects | REQUIRED | At least one endpoint object. See §7. |
| `authentication` | object | REQUIRED | Authentication requirements. See §8. |
| `pricing` | object | REQUIRED | Informational pricing metadata. See §9. |
| `payment` | object or null | OPTIONAL | Executable payment contract. See §10. |
| `rate_limits` | object | OPTIONAL | Rate limiting configuration. |
| `reliability` | object | OPTIONAL | Uptime and performance metrics. See §15. |
| `agent_notes` | string | REQUIRED | Operational guidance for agents. Minimum 150 characters. |
| `contact` | string or object | REQUIRED | Email address, HTTPS URL, or contact object. |
| `listing_requested` | boolean | OPTIONAL | `true` if the provider wants registry inclusion. |
| `last_updated` | string (ISO 8601) | REQUIRED | Timestamp of last manifest update. |

### 4.2 Backward Compatibility

A v0.3 manifest MUST be safely parseable by a v0.2 consumer. Consumers that do not recognize the `payment` field MUST ignore it. The `pricing` field (§9) continues to serve as the informational pricing summary for consumers that do not implement the payment protocol.

API providers that add a `payment` block SHOULD ensure the `pricing` block remains accurate and consistent with the payment terms declared in `payment`.

---

## 5. Identity Fields

Unchanged from v0.2.

- `spec_version`: MUST be `"agentmanifest-0.3"`.
- `name`: 3–100 characters. Human-readable.
- `version`: Semantic versioning format (`major.minor.patch`).
- `description`: Minimum 100 characters. SHOULD explain what the API knows, what problems it solves, and what data it provides.
- `homepage`: OPTIONAL. Valid HTTPS URL.
- `documentation`: OPTIONAL. Valid HTTPS URL.

---

## 6. Categorization

AMP uses two complementary taxonomies to classify APIs:

1. **Domain categories** (`categories`): Describe the subject matter or knowledge domain of the API.
2. **Functional classification** (`primary_category`): Describes the operational role of the API — what kind of service it provides.

### 6.1 Domain Categories (Controlled Vocabulary)

The `categories` array MUST contain one or more of the following domain category values:

`chemistry`, `biology`, `physics`, `mathematics`, `finance`, `weather`, `geography`, `food-science`, `engineering`, `legal`, `medical`, `education`, `translation`, `media`, `materials`, `construction`, `music-gear`, `agriculture`, `computing`, `language`, `history`, `commerce`, `identity`, `logistics`, `other`

Category names use lowercase with hyphens (e.g., `food-science`, `music-gear`).

### 6.2 Functional Classification

The `primary_category` field MUST be one of:

| Value | Description |
|---|---|
| `reference` | Static knowledge bases, documentation, reference data. |
| `live` | Real-time data sources (weather, markets, sensors). |
| `computational` | APIs that perform calculations or transformations. |
| `transactional` | APIs that execute actions or state changes. |
| `enrichment` | APIs that augment existing data with additional context. |
| `personal` | User-specific data requiring authentication. |
| `discovery` | Meta-APIs for finding other data sources. |

### 6.3 Rules

- `primary_category` MUST be one of the functional classification values listed in §6.2.
- `categories` MUST contain at least one domain category value from §6.1.
- An API's `primary_category` and `categories` are independent — `primary_category` does not need to appear in the `categories` array.

---

## 7. Endpoints

Each endpoint object describes one API operation.

### 7.1 Endpoint Object

| Field | Type | Required | Description |
|---|---|---|---|
| `path` | string | REQUIRED | The URL path (e.g., `/ingredients`). |
| `method` | string | REQUIRED | HTTP method: `GET`, `POST`, `PUT`, `DELETE`, `PATCH`. |
| `description` | string | REQUIRED | What this endpoint does. Minimum 20 characters. |
| `parameters` | array or object | REQUIRED | Parameter definitions. May be empty array `[]`. |
| `response_description` | string | REQUIRED | What the response contains. Minimum 20 characters. |
| `examples` | array | OPTIONAL | Request/response examples. |
| `cost_hint` | object | OPTIONAL | **New in v0.3.** Estimated cost metadata for this specific endpoint. See §7.2. |

### 7.2 Endpoint Cost Hint (New in v0.3)

When an API has variable pricing per endpoint (e.g., a search endpoint is cheaper than a compute endpoint), the `cost_hint` object allows per-endpoint cost guidance.

```json
{
  "cost_hint": {
    "unit": "request",
    "estimated_price": "0.002",
    "currency": "USD",
    "notes": "Price varies based on result count. Typical request costs $0.001–$0.005."
  }
}
```

| Field | Type | Required | Description |
|---|---|---|---|
| `unit` | string | REQUIRED | The billing unit for this endpoint. |
| `estimated_price` | string | REQUIRED | Estimated cost per unit as a decimal string. |
| `currency` | string | REQUIRED | ISO 4217 code or unit identifier. |
| `notes` | string | OPTIONAL | Human/agent-readable pricing notes. |

The `cost_hint` is informational. The authoritative cost is determined by the `payment.rates` array and the actual cost reported in response headers (§13).

---

## 8. Authentication

Unchanged from v0.2.

### 8.1 Authentication Object

| Field | Type | Required | Description |
|---|---|---|---|
| `required` | boolean | REQUIRED | Whether authentication is needed. |
| `type` | string or null | Conditional | One of: `api_key`, `oauth2`, `bearer`, `none`. REQUIRED if `required` is `true`. |
| `instructions` | string or null | Conditional | How to obtain credentials. REQUIRED if `required` is `true`. |
| `config` | object | OPTIONAL | Additional configuration (e.g., `header` name, `signup_url`). |

### 8.2 Consistency Rules

- If `required` is `true`, both `type` and `instructions` MUST be non-null.
- If `required` is `false`, `type` SHOULD be `"none"` or `null`.

---

## 9. Pricing (Informational)

The `pricing` object is an informational summary of the API's cost structure. It is retained from v0.2 for backward compatibility and for consumers that do not implement the v0.3 payment protocol.

### 9.1 Pricing Object

| Field | Type | Required | Description |
|---|---|---|---|
| `model` | string | REQUIRED | One of: `free`, `per-query`, `subscription`, `pay-what-you-want`, `tiered`, `usage_based`. |
| `free_tier` | object or null | Conditional | Free tier details. REQUIRED when `model` is `free`. |
| `paid_tier` | object or null | Conditional | Paid tier details. REQUIRED when `model` is not `free`. |
| `support_url` | string (URL) | OPTIONAL | URL for billing support or payment info. |

### 9.2 Consistency Rules

- If `model` is `free`, `free_tier` MUST be non-null.
- If `model` is not `free`, `paid_tier` MUST be non-null and MUST include `amount_usd`, `unit`, and `description`.

---

## 10. Payment

The `payment` object is **new in v0.3**. It declares the machine-executable payment contract that agents use to autonomously establish and manage billing relationships.

If the API is free, `payment` SHOULD be `null` or omitted entirely. If `payment` is omitted, agents MUST assume the API follows the terms described in the `pricing` block and that no autonomous payment flow is available.

### 10.1 Payment Object Schema

```json
{
  "payment": {
    "model": "metered_usage",
    "currency": "USD",
    "rates": [
      {
        "unit": "request",
        "price": "0.001",
        "description": "Per API request"
      }
    ],
    "onboarding": {
      "url": "https://api.example.com/amp/onboard",
      "method": "POST",
      "accepts": ["signed_jwt", "platform_token"],
      "returns": {
        "credential_type": "api_key",
        "credential_field": "api_key",
        "instructions": "Include the returned API key in the X-API-Key header on all subsequent requests."
      }
    },
    "usage_endpoint": {
      "url": "https://api.example.com/amp/usage",
      "method": "GET",
      "authentication": "same_as_api"
    },
    "settlement": {
      "type": "real_time",
      "cycle": null,
      "provider_name": null,
      "provider_url": null
    },
    "budget_controls": {
      "supports_spend_cap": true,
      "supports_per_request_limit": false,
      "supports_rate_limit": true,
      "supports_alerting": false
    },
    "refund_policy": {
      "type": "none",
      "terms_url": null
    }
  }
}
```

### 10.2 Field Definitions

#### `payment.model` (REQUIRED)

The payment model. MUST be one of:

| Value | Description |
|---|---|
| `free` | No payment required. Equivalent to `"payment": null`. |
| `per_request` | Each API call incurs a fixed charge. |
| `metered_usage` | Charges accumulate based on consumption of a metered unit (requests, tokens, bytes, compute time, etc.). |
| `prepaid_credits` | Agent purchases a credit balance upfront; credits are debited per use. |
| `subscription` | Recurring fixed-fee access for a defined period. |

This enum is extensible. Consumers that encounter an unrecognized model value MUST treat the API as requiring manual payment setup and SHOULD NOT attempt autonomous onboarding.

#### `payment.currency` (REQUIRED)

The currency for all prices in the `rates` array.

- For fiat currencies: an [ISO 4217](https://en.wikipedia.org/wiki/ISO_4217) currency code (e.g., `"USD"`, `"EUR"`, `"GBP"`).
- For non-fiat units: a string identifier prefixed with `x-` (e.g., `"x-platform-credits"`, `"x-compute-units"`).

#### `payment.rates` (REQUIRED)

An array of rate objects. MUST contain at least one entry unless `model` is `free`.

Each rate object:

| Field | Type | Required | Description |
|---|---|---|---|
| `unit` | string | REQUIRED | The billing unit. Common values: `request`, `token`, `byte`, `compute_second`, `query`, `record`. Custom units SHOULD be prefixed with `x-`. |
| `price` | string | REQUIRED | Cost per unit as a decimal string (e.g., `"0.001"`). String type to avoid floating-point precision issues. |
| `description` | string | OPTIONAL | Human/agent-readable description of this rate. |
| `tier` | string or null | OPTIONAL | Tier name for volume-based pricing (e.g., `"standard"`, `"high_volume"`). |
| `threshold` | integer or null | OPTIONAL | Usage threshold at which this rate applies. `null` or `0` means this is the base rate. |
| `cap` | integer or null | OPTIONAL | Upper bound of this tier. `null` means unlimited. |

**Tiered pricing example:**

```json
"rates": [
  {
    "unit": "request",
    "price": "0.01",
    "tier": "standard",
    "threshold": 0,
    "cap": 10000,
    "description": "First 10,000 requests per month"
  },
  {
    "unit": "request",
    "price": "0.005",
    "tier": "high_volume",
    "threshold": 10001,
    "cap": null,
    "description": "Requests beyond 10,000 per month"
  }
]
```

#### `payment.onboarding` (Conditional)

REQUIRED when `model` is not `free`. Describes the autonomous onboarding flow.

| Field | Type | Required | Description |
|---|---|---|---|
| `url` | string (URL) | REQUIRED | HTTPS endpoint the agent calls to initiate payment onboarding. |
| `method` | string | REQUIRED | HTTP method. Typically `POST`. |
| `accepts` | array of strings | REQUIRED | Credential types the endpoint accepts. Values from the `credential_type` enum (§11). |
| `returns` | object | REQUIRED | Describes what the endpoint returns on success. |

**`onboarding.returns` object:**

| Field | Type | Required | Description |
|---|---|---|---|
| `credential_type` | string | REQUIRED | Type of access credential returned. This is distinct from the agent's `credential_type` in §11 (which describes what the agent *sends*). Values: `api_key`, `bearer_token`, `session_token`, `subscription_id`. |
| `credential_field` | string | REQUIRED | The JSON field name in the response body that contains the credential value. |
| `instructions` | string | REQUIRED | How the agent should use the returned credential (e.g., which header to set). |
| `expires_in` | integer or null | OPTIONAL | Credential lifetime in seconds. `null` means no expiration. |
| `refresh_url` | string (URL) or null | OPTIONAL | Endpoint to refresh an expiring credential. |

#### `payment.usage_endpoint` (OPTIONAL)

An endpoint the agent can poll to check its current usage and remaining budget.

| Field | Type | Required | Description |
|---|---|---|---|
| `url` | string (URL) | REQUIRED | HTTPS endpoint. |
| `method` | string | REQUIRED | HTTP method. Typically `GET`. |
| `authentication` | string | REQUIRED | One of: `same_as_api` (use the same credential as API requests) or `onboarding_credential` (use the credential returned during onboarding). |

The usage endpoint MUST return a JSON response with at minimum:

```json
{
  "currency": "USD",
  "total_spent": "12.50",
  "budget_limit": "100.00",
  "budget_remaining": "87.50",
  "current_period_start": "2026-02-01T00:00:00Z",
  "current_period_end": "2026-03-01T00:00:00Z",
  "usage_details": [
    {
      "unit": "request",
      "quantity": 12500,
      "cost": "12.50"
    }
  ]
}
```

#### `payment.settlement` (REQUIRED)

How and when charges are settled.

| Field | Type | Required | Description |
|---|---|---|---|
| `type` | string | REQUIRED | One of: `real_time`, `postpaid_cycle`, `prepaid_debit`. |
| `cycle` | string or null | OPTIONAL | Settlement cycle. One of: `daily`, `weekly`, `monthly`, `quarterly`, `annual`. REQUIRED when `type` is `postpaid_cycle`. |
| `provider_name` | string or null | OPTIONAL | Name of the settlement provider (informational only). |
| `provider_url` | string (URL) or null | OPTIONAL | URL for the settlement provider's dashboard or portal. |

**Settlement type definitions:**

| Value | Description |
|---|---|
| `real_time` | Each request is charged immediately. The agent's balance or payment method is debited in real time. |
| `postpaid_cycle` | Usage is accumulated and invoiced at the end of each `cycle`. |
| `prepaid_debit` | The agent pre-purchases credits. Each request debits from the credit balance. |

#### `payment.budget_controls` (OPTIONAL)

Declares what server-side budget enforcement the API supports.

| Field | Type | Required | Description |
|---|---|---|---|
| `supports_spend_cap` | boolean | OPTIONAL | API can enforce a maximum total spend. Default: `false`. |
| `supports_per_request_limit` | boolean | OPTIONAL | API can reject requests exceeding a per-request cost threshold. Default: `false`. |
| `supports_rate_limit` | boolean | OPTIONAL | API enforces request rate limits. Default: `false`. |
| `supports_alerting` | boolean | OPTIONAL | API can send budget threshold alerts. Default: `false`. |

When `supports_spend_cap` is `true`, the agent MAY include a spend cap in its onboarding request. The API MUST reject requests that would exceed the declared cap with a `402` response (§14).

#### `payment.refund_policy` (OPTIONAL)

| Field | Type | Required | Description |
|---|---|---|---|
| `type` | string | REQUIRED | One of: `none`, `full`, `partial`, `prorated`, `credit`. |
| `terms_url` | string (URL) or null | OPTIONAL | URL to detailed refund terms. |
| `window_seconds` | integer or null | OPTIONAL | Time window (in seconds) after a charge during which a refund may be requested. |

---

## 11. Agent Payment Credentials

An **agent payment credential** is a structured token that an agent presents to an API during payment onboarding. It proves the agent is authorized to spend up to a declared budget on behalf of a principal (a human or organization).

AMP does **not** issue these credentials. AMP defines the schema and verification protocol. Any platform, organization, or system can issue AMP-compatible payment credentials.

### 11.1 Credential Schema

```json
{
  "amp_version": "0.3",
  "principal": {
    "id": "org_abc123",
    "name": "Acme Corp",
    "type": "organization"
  },
  "budget": {
    "amount": "100.00",
    "currency": "USD",
    "period": "monthly",
    "period_start": "2026-02-01T00:00:00Z"
  },
  "scope": {
    "categories": ["chemistry", "food_science"],
    "api_domains": ["*.example.com"],
    "max_per_request": "1.00"
  },
  "credential_type": "signed_jwt",
  "credential": "eyJhbGciOiJFUzI1NiIs...",
  "issued_by": {
    "name": "AgentPlatform",
    "verification_url": "https://agentplatform.com/.well-known/amp-verification",
    "public_key_url": "https://agentplatform.com/.well-known/amp-public-key.pem"
  },
  "issued_at": "2026-02-01T00:00:00Z",
  "expires_at": "2026-03-01T00:00:00Z",
  "nonce": "a1b2c3d4e5f6"
}
```

### 11.2 Field Definitions

#### `amp_version` (REQUIRED)

The AMP spec version this credential conforms to. MUST be `"0.3"`.

#### `principal` (REQUIRED)

The human or organization that authorized spending.

| Field | Type | Required | Description |
|---|---|---|---|
| `id` | string | REQUIRED | Unique identifier for the principal within the issuing platform. |
| `name` | string | OPTIONAL | Human-readable name. |
| `type` | string | REQUIRED | One of: `individual`, `organization`, `service_account`. |

#### `budget` (REQUIRED)

The maximum authorized spend.

| Field | Type | Required | Description |
|---|---|---|---|
| `amount` | string | REQUIRED | Maximum spend as a decimal string. |
| `currency` | string | REQUIRED | ISO 4217 code or `x-` prefixed unit identifier. MUST match the API's `payment.currency` or be convertible by the API. |
| `period` | string | REQUIRED | Budget period. One of: `once`, `hourly`, `daily`, `weekly`, `monthly`, `quarterly`, `annual`. |
| `period_start` | string (ISO 8601) | OPTIONAL | Start of the current budget period. |

#### `scope` (OPTIONAL)

Limits where this credential may be used.

| Field | Type | Required | Description |
|---|---|---|---|
| `categories` | array of strings | OPTIONAL | AMP categories this credential is authorized for. If omitted, no category restriction. |
| `api_domains` | array of strings | OPTIONAL | Domain patterns this credential is authorized for. Supports wildcards (e.g., `"*.example.com"`). If omitted, no domain restriction. |
| `max_per_request` | string | OPTIONAL | Maximum cost per individual request. |

#### `credential_type` (REQUIRED)

The type of the `credential` value that the agent sends to prove spending authorization. This enum is distinct from `payment.onboarding.returns.credential_type` (§10.2), which describes the type of access credential the API *returns* after successful onboarding.

MUST be one of:

| Value | Description |
|---|---|
| `signed_jwt` | A JSON Web Token signed by the issuer. The API verifies the signature using the issuer's public key. |
| `platform_token` | An opaque token issued by a platform. The API verifies by calling back to the issuer's `verification_url`. |
| `oauth_bearer` | An OAuth 2.0 bearer token. The API verifies via token introspection or the issuer's `verification_url`. |

This enum is extensible. APIs that encounter an unrecognized `credential_type` MUST reject the onboarding request with HTTP 400.

#### `credential` (REQUIRED)

The credential value. Format depends on `credential_type`.

#### `issued_by` (REQUIRED)

The platform or system that issued this credential.

| Field | Type | Required | Description |
|---|---|---|---|
| `name` | string | REQUIRED | Name of the issuing platform. |
| `verification_url` | string (URL) | OPTIONAL | HTTPS endpoint the API can call to verify the credential. See §11.3. |
| `public_key_url` | string (URL) | OPTIONAL | HTTPS endpoint serving the issuer's public key (PEM or JWK format) for signature verification. |

At least one of `verification_url` or `public_key_url` MUST be provided.

#### `issued_at` (REQUIRED)

ISO 8601 timestamp of when the credential was issued.

#### `expires_at` (REQUIRED)

ISO 8601 timestamp of when the credential expires. APIs MUST reject expired credentials.

#### `nonce` (REQUIRED)

A unique, single-use value to prevent replay attacks. The API SHOULD track seen nonces and reject duplicates within the credential's validity window.

### 11.3 Credential Verification

APIs MUST verify agent payment credentials before provisioning a billing relationship. Two verification methods are defined:

#### Method A: Signature Verification (for `signed_jwt`)

1. API fetches the issuer's public key from `issued_by.public_key_url`.
2. API verifies the JWT signature against the public key.
3. API checks that `expires_at` is in the future.
4. API checks the `nonce` has not been seen before.
5. API checks that its own domain is permitted by the credential's `scope.api_domains` (if present).
6. API checks that its categories overlap with the credential's `scope.categories` (if present).

Public keys SHOULD be cached with a TTL of no more than 24 hours. The key endpoint MUST support HTTPS and SHOULD return appropriate `Cache-Control` headers.

#### Method B: Issuer Callback (for `platform_token` and `oauth_bearer`)

1. API sends a verification request to `issued_by.verification_url`:

```http
POST /amp-verification HTTP/1.1
Host: agentplatform.com
Content-Type: application/json

{
  "credential": "the-token-value",
  "credential_type": "platform_token",
  "api_domain": "api.example.com",
  "api_categories": ["chemistry"],
  "requested_budget": "50.00",
  "requested_currency": "USD",
  "nonce": "a1b2c3d4e5f6"
}
```

2. The issuer responds with:

```json
{
  "valid": true,
  "principal_id": "org_abc123",
  "authorized_budget": "50.00",
  "authorized_currency": "USD",
  "expires_at": "2026-03-01T00:00:00Z"
}
```

Or on failure:

```json
{
  "valid": false,
  "reason": "credential_expired"
}
```

3. The API proceeds only if `valid` is `true` and the authorized budget is sufficient.

#### Verification Failures

If verification fails, the API MUST respond to the onboarding request with:

- **401 Unauthorized** if the credential is invalid, expired, or revoked.
- **403 Forbidden** if the credential is valid but the scope does not cover this API.
- **400 Bad Request** if the credential format is unrecognized or malformed.

---

## 12. Payment Onboarding Flow

This section defines the step-by-step protocol for autonomous payment onboarding.

### 12.1 Flow Overview

```
Agent                              API Provider                    Credential Issuer
  |                                     |                                |
  |  1. GET /.well-known/agent-manifest.json                             |
  |------------------------------------>|                                |
  |  2. Manifest (with payment block)   |                                |
  |<------------------------------------|                                |
  |                                     |                                |
  |  3. Evaluate cost vs. budget        |                                |
  |                                     |                                |
  |  4. POST /amp/onboard               |                                |
  |     (agent_payment_credential)      |                                |
  |------------------------------------>|                                |
  |                                     |  5. Verify credential          |
  |                                     |-------------------------------->|
  |                                     |  6. Verification result        |
  |                                     |<--------------------------------|
  |                                     |                                |
  |  7. Onboarding response             |                                |
  |     (access credential)             |                                |
  |<------------------------------------|                                |
  |                                     |                                |
  |  8. API request + access credential |                                |
  |     + budget headers                |                                |
  |------------------------------------>|                                |
  |  9. API response + cost headers     |                                |
  |<------------------------------------|                                |
```

### 12.2 Detailed Steps

**Step 1: Manifest Retrieval**

The agent fetches the API manifest from `/.well-known/agent-manifest.json`.

**Step 2: Payment Evaluation**

The agent parses the `payment` block and evaluates:

- Is the `payment.model` supported by the agent?
- Are the `payment.rates` within the agent's budget constraints?
- Does the agent hold a credential with a `credential_type` listed in `payment.onboarding.accepts`?
- Does the credential's `scope` cover this API's domain and categories?

If any check fails, the agent MUST NOT proceed with onboarding.

**Step 3: Onboarding Request**

The agent sends an HTTP request to `payment.onboarding.url` using the declared `payment.onboarding.method`.

Request body:

```json
{
  "agent_payment_credential": { ... },
  "requested_plan": {
    "model": "metered_usage",
    "spend_cap": "50.00",
    "currency": "USD"
  }
}
```

| Field | Type | Required | Description |
|---|---|---|---|
| `agent_payment_credential` | object | REQUIRED | The full credential object as defined in §11. |
| `requested_plan` | object | OPTIONAL | Agent's preferred terms. |
| `requested_plan.model` | string | OPTIONAL | The payment model the agent prefers. MUST match the API's declared model. |
| `requested_plan.spend_cap` | string | OPTIONAL | Maximum the agent is willing to spend. Only meaningful if the API's `budget_controls.supports_spend_cap` is `true`. |
| `requested_plan.currency` | string | OPTIONAL | Currency for the spend cap. |

**Step 4: Credential Verification**

The API verifies the agent's payment credential using one of the methods described in §11.3.

**Step 5: Provisioning**

On successful verification, the API:

1. Creates a billing relationship for the agent/principal.
2. Configures any requested budget controls (spend cap, rate limits).
3. Generates an access credential for subsequent API calls.

**Step 6: Onboarding Response**

Success (HTTP 201 Created):

```json
{
  "status": "active",
  "credential_type": "api_key",
  "api_key": "amp_live_abc123def456",
  "spend_cap": "50.00",
  "currency": "USD",
  "rate_limits": {
    "requests_per_minute": 60,
    "requests_per_day": 10000
  },
  "expires_at": "2026-03-01T00:00:00Z",
  "usage_endpoint": "https://api.example.com/amp/usage"
}
```

The credential field name in the response MUST match the value declared in `payment.onboarding.returns.credential_field`.

**Step 7: Subsequent API Usage**

The agent includes the returned credential in all subsequent API requests, following the instructions in `payment.onboarding.returns.instructions`. The agent SHOULD include budget enforcement headers (§13) on each request.

### 12.3 Error Handling

| HTTP Status | Condition | Agent Behavior |
|---|---|---|
| 201 Created | Onboarding successful. | Proceed with API usage. |
| 400 Bad Request | Malformed request or unrecognized credential type. | Do not retry. Fix the request. |
| 401 Unauthorized | Credential invalid, expired, or revoked. | Obtain a new credential and retry once. |
| 403 Forbidden | Credential valid but scope insufficient. | Do not retry with the same credential. |
| 409 Conflict | A billing relationship already exists for this principal. | Use the existing credential or call the usage endpoint. |
| 422 Unprocessable Entity | Requested plan terms are not available. | Retry with different plan parameters or proceed without a spend cap. |
| 429 Too Many Requests | Rate limited. | Respect `Retry-After` header. |
| 500+ | Server error. | Retry with exponential backoff up to 3 times. |

### 12.4 Retry Policy

Agents SHOULD implement the following retry behavior:

- **Retryable errors:** 429, 500, 502, 503, 504.
- **Max retries:** 3.
- **Backoff:** Exponential with jitter. Initial delay: 1 second. Maximum delay: 30 seconds.
- **Non-retryable errors:** 400, 401, 403, 409, 422.

---

## 13. Budget Enforcement Headers

These HTTP headers enable real-time budget communication between agent and API during normal request/response cycles.

### 13.1 Request Headers (Agent → API)

| Header | Required | Description |
|---|---|---|
| `X-AMP-Budget-Limit` | OPTIONAL | The agent's total budget for this service, as a decimal string with currency (e.g., `50.00 USD`). |
| `X-AMP-Max-Request-Cost` | OPTIONAL | Maximum acceptable cost for this individual request. If the request would exceed this amount, the API SHOULD return a `402` response with a cost estimate instead of executing the request. |
| `X-AMP-Request-Params` | OPTIONAL | JSON-encoded request parameters, sent with `OPTIONS` preflight requests to enable cost estimation without executing the request. |

### 13.2 Response Headers (API → Agent)

| Header | Required | Description |
|---|---|---|
| `X-AMP-Request-Cost` | REQUIRED on paid APIs | The actual cost of this specific request, as a decimal string (e.g., `0.003`). |
| `X-AMP-Budget-Spent` | RECOMMENDED | Total spend by this agent in the current billing period. |
| `X-AMP-Budget-Remaining` | RECOMMENDED | Remaining budget for this agent. |
| `X-AMP-Cost-Estimate` | REQUIRED on `OPTIONS` | Estimated cost of the request, returned on `OPTIONS` (preflight) requests. |

### 13.3 Preflight Cost Estimation

An agent MAY send an `OPTIONS` request to any API endpoint to obtain a cost estimate before executing the actual request. The agent SHOULD include request parameters as query parameters or in the `X-AMP-Request-Params` header (JSON-encoded).

The API MUST respond to `OPTIONS` requests with the `X-AMP-Cost-Estimate` header. The estimate is non-binding but SHOULD be within 20% of the actual cost for typical requests.

```http
OPTIONS /compute/expensive-analysis HTTP/1.1
Host: api.example.com
X-API-Key: amp_live_abc123
X-AMP-Request-Params: {"dataset": "large", "depth": 5}

HTTP/1.1 204 No Content
X-AMP-Cost-Estimate: 0.25
X-AMP-Budget-Spent: 12.50
X-AMP-Budget-Remaining: 37.50
```

### 13.4 Budget Exhaustion Behavior

When an agent's budget is exhausted or would be exceeded by a request:

1. The API MUST return HTTP `402 Payment Required` (see §14).
2. The API MUST NOT execute the request or incur any cost.
3. The API SHOULD include `X-AMP-Budget-Spent` and `X-AMP-Budget-Remaining: 0.00` in the response headers.

When budget is approaching exhaustion (less than 10% remaining), the API SHOULD include a `Warning` header:

```
Warning: 199 - "AMP budget below 10%: 4.50 USD remaining"
```

---

## 14. The 402 Payment Required Response

When a request is rejected for payment-related reasons, the API MUST return HTTP 402 with a structured JSON response body.

### 14.1 Response Schema

```json
{
  "error": "payment_required",
  "reason": "budget_exceeded",
  "message": "Request would exceed your configured spend cap.",
  "current_usage": {
    "total_spent": "50.00",
    "currency": "USD",
    "period": "monthly",
    "period_start": "2026-02-01T00:00:00Z"
  },
  "limit": {
    "type": "spend_cap",
    "amount": "50.00",
    "currency": "USD"
  },
  "request_cost": {
    "estimated": "0.25",
    "currency": "USD"
  },
  "resolution": {
    "action": "increase_budget",
    "topup_url": "https://api.example.com/amp/topup",
    "topup_method": "POST",
    "description": "Submit a new agent payment credential with a higher spend cap."
  }
}
```

### 14.2 Field Definitions

#### `error` (REQUIRED)

MUST be `"payment_required"`.

#### `reason` (REQUIRED)

MUST be one of:

| Value | Description |
|---|---|
| `budget_exceeded` | The agent's spend cap or budget limit has been reached. |
| `credits_exhausted` | Prepaid credit balance is zero. |
| `payment_failed` | A charge attempt failed (e.g., expired payment method on file). |
| `subscription_expired` | The agent's subscription period has ended. |
| `rate_limit_exceeded` | The agent has exceeded its rate limit. |
| `insufficient_credits` | Prepaid balance is too low for this specific request. |
| `no_billing_relationship` | The agent has not completed payment onboarding. |

#### `message` (REQUIRED)

A human/agent-readable description of the problem.

#### `current_usage` (OPTIONAL)

Current spend information for the agent.

| Field | Type | Description |
|---|---|---|
| `total_spent` | string | Total spent in the current period. |
| `currency` | string | Currency of the amount. |
| `period` | string | Current billing period type. |
| `period_start` | string (ISO 8601) | Start of current period. |

#### `limit` (REQUIRED)

The limit that was hit.

| Field | Type | Description |
|---|---|---|
| `type` | string | One of: `spend_cap`, `credit_balance`, `rate_limit`, `subscription`. |
| `amount` | string | The limit value. |
| `currency` | string | Currency (or `"requests_per_minute"` for rate limits). |

#### `request_cost` (OPTIONAL)

Estimated cost of the rejected request.

| Field | Type | Description |
|---|---|---|
| `estimated` | string | Estimated cost as decimal string. |
| `currency` | string | Currency. |

#### `resolution` (REQUIRED)

Machine-readable instructions for resolving the payment issue.

| Field | Type | Required | Description |
|---|---|---|---|
| `action` | string | REQUIRED | One of: `increase_budget`, `topup_credits`, `renew_subscription`, `retry_payment`, `complete_onboarding`. |
| `topup_url` | string (URL) | OPTIONAL | Endpoint for automated resolution (e.g., credit replenishment). |
| `topup_method` | string | OPTIONAL | HTTP method for the topup URL. |
| `description` | string | REQUIRED | Explanation of how to resolve the issue. |

---

## 15. Reliability

OPTIONAL. Unchanged from v0.2.

| Field | Type | Description |
|---|---|---|
| `uptime_percentage` | number | Declared uptime (e.g., `99.9`). |
| `avg_response_time_ms` | integer | Average response time in milliseconds. |
| `last_30_days_uptime` | number | Actual uptime over the last 30 days. |

---

## 16. Agent Notes

The `agent_notes` field provides operational guidance specifically for AI agents.

- MUST be at least 150 characters.
- SHOULD contain procedural guidance, not marketing copy.
- SHOULD address: how to authenticate, what to expect from responses, common pitfalls, and rate limiting behavior.
- For v0.3: SHOULD mention payment onboarding if the API uses the payment protocol.

---

## 17. Agent Operational Completeness

A manifest achieves **agent operational completeness** when its `agent_notes` field contains sufficient guidance for an agent to use the API without prior knowledge.

### 17.1 Requirements

The `agent_notes` MUST contain references to all of:

1. Account or registration requirements (the term "account")
2. Authentication method (the terms "authentication" or "api key" or "bearer")
3. Pricing information (the term "pricing" or "cost" or "free")

Manifests failing this test produce the validation error: `"Manifest lacks agent-operational completeness."`

### 17.2 v0.3 Extension

For manifests with a non-null `payment` block, the `agent_notes` SHOULD additionally reference the payment onboarding flow (the terms "payment" or "onboarding" or "budget").

---

## 18. Validation

### 18.1 Core Checks (Always Run)

1. Manifest reachable at `/.well-known/agent-manifest.json` via HTTPS.
2. Response is valid JSON with `Content-Type: application/json`.
3. `spec_version` is `"agentmanifest-0.3"` (or `"agentmanifest-0.2"` for backward compatibility).
4. All required fields are present and correctly typed.
5. `description` ≥ 100 characters.
6. `agent_notes` ≥ 150 characters.
7. At least one endpoint defined.
8. Endpoint `description` ≥ 20 characters.
9. `primary_category` is a valid functional classification value (§6.2). `categories` contains only valid domain category values (§6.1).
10. Pricing model consistency (§9.2).
11. Authentication consistency (§8.2).
12. All declared URLs are valid HTTPS.

### 18.2 Payment Checks (When `payment` is Non-Null)

13. `payment.model` is a recognized enum value.
14. `payment.currency` is a valid ISO 4217 code or `x-` prefixed identifier.
15. `payment.rates` contains at least one entry (unless `model` is `free`).
16. All `rates[].price` values are valid decimal strings.
17. `payment.onboarding.url` is reachable via HTTP HEAD.
18. `payment.onboarding.accepts` contains at least one value.
19. `payment.onboarding.returns` contains all required fields.
20. `payment.settlement.type` is a recognized enum value.
21. If `settlement.type` is `postpaid_cycle`, `settlement.cycle` MUST be non-null.
22. If `payment.usage_endpoint` is present, the URL is reachable via HTTP HEAD.

### 18.3 Extended Checks

23. Authentication flow verification (for declared auth types).
24. Payment onboarding flow verification (test with a synthetic credential).
25. Agent operational completeness (§17).
26. Endpoint reachability.

### 18.4 Registry Badges

| Badge | Criteria |
|---|---|
| `auth-verified` | Authentication flow confirmed functional. |
| `payment-ready` | Payment onboarding endpoint responds correctly to well-formed requests. |
| `budget-aware` | API declares support for budget controls (spend caps or per-request limits) in `payment.budget_controls`. |

Badges are informational only and imply no liability or endorsement.

---

## 19. Registry

### 19.1 Submission

```
POST /listings/submit
Content-Type: application/json

{ "url": "https://api.example.com" }
```

Automated workflow:

1. Fetch manifest from provided URL.
2. Validate against AMP v0.3 specification.
3. Extract metadata for indexing, including payment model and rates.
4. Add to searchable registry.
5. Return listing ID and status.

### 19.2 Discovery

```
GET /listings?category=chemistry&pricing_model=free&payment_model=metered_usage
```

New v0.3 query parameters:

| Parameter | Description |
|---|---|
| `payment_model` | Filter by `payment.model` value. |
| `payment_currency` | Filter by supported currency. |
| `settlement_type` | Filter by settlement type. |
| `supports_spend_cap` | Filter for APIs supporting budget spend caps (`true` or `false`). |

### 19.3 Eligibility Rules

Unchanged from v0.2:

- APIs MUST pass all validator checks.
- Manifests MUST accurately describe actual behavior.
- APIs MUST return consistent data to validators and consumers.
- APIs MUST NOT be designed to deceive, harvest data without consent, or cause harm.

---

## 20. Security Considerations

### 20.1 Credential Replay Prevention

Agent payment credentials include a `nonce` field (§11.1). APIs MUST:

- Track nonces for the duration of the credential's validity window.
- Reject any credential with a previously-seen nonce.
- Reject credentials where `expires_at` is in the past.

For `signed_jwt` credentials, the JWT itself SHOULD include the nonce in its claims. APIs verify the signature first, then check nonce uniqueness.

### 20.2 Credential Scoping

Credentials SHOULD be scoped as narrowly as practical:

- Use `scope.categories` to restrict spending to relevant API categories.
- Use `scope.api_domains` to restrict to known API providers.
- Use `scope.max_per_request` to cap individual transaction size.
- Use short `expires_at` windows (hours or days, not months).

Credential issuers SHOULD provide tools for principals to define and manage spending scopes.

### 20.3 Credential Rotation

- Access credentials returned during onboarding SHOULD have a finite lifetime (`expires_at` in the onboarding response).
- When `payment.onboarding.returns.refresh_url` is provided, agents SHOULD proactively refresh credentials before expiration.
- APIs SHOULD support credential rotation without requiring full re-onboarding.
- Issuers SHOULD support credential revocation via their verification endpoint.

### 20.4 Budget Limits as a Safety Net

Budget limits are a defense-in-depth mechanism against runaway spend:

- Agents SHOULD always declare a spend cap during onboarding.
- APIs that support `budget_controls.supports_spend_cap` MUST enforce the cap server-side.
- Even without server-side enforcement, agents SHOULD track their own spend using budget headers and cease requests when approaching their limit.
- The combination of credential-level budget (`agent_payment_credential.budget.amount`) and onboarding-level spend cap (`requested_plan.spend_cap`) provides two independent guardrails.

### 20.5 Trust Model

AMP's payment protocol involves four parties:

| Party | Role | Trust Relationship |
|---|---|---|
| **Principal** | Human or org authorizing spend. | Issues spending authority to the agent via a credential issuer. |
| **Agent** | Software acting on behalf of the principal. | Trusted by principal to stay within budget. Verified by API via credential. |
| **API Provider** | The service being consumed. | Trusts the credential issuer's verification. Enforces budget controls. |
| **Credential Issuer** | Platform that issues agent payment credentials. | Trusted by both principal and API to accurately represent spending authority. |

No single party has unilateral control. The principal sets the budget, the issuer attests to it, the agent presents it, and the API enforces it.

### 20.6 Rate Limiting

Rate limiting complements budget controls:

- Budget controls prevent overspending.
- Rate limits prevent abuse patterns (e.g., rapid-fire requests within budget).
- APIs SHOULD implement both.
- Rate limit information SHOULD be communicated via standard `RateLimit-*` headers ([draft-ietf-httpapi-ratelimit-headers](https://datatracker.ietf.org/doc/draft-ietf-httpapi-ratelimit-headers/)).

### 20.7 Transport Security

- All manifest URLs MUST use HTTPS.
- All onboarding, verification, usage, and top-up endpoints MUST use HTTPS.
- APIs SHOULD require TLS 1.2 or later.
- Credential values MUST NOT appear in URL query parameters; they MUST be transmitted in request headers or bodies.

---

## 21. Complete Manifest Examples

### 21.1 Free API

```json
{
  "spec_version": "agentmanifest-0.3",
  "name": "Open Chemistry Reference",
  "version": "2.1.0",
  "description": "A comprehensive open-access chemistry reference API providing molecular data, reaction equations, and compound properties for over 50,000 substances. Designed for AI agent consumption with semantic metadata on every response.",
  "homepage": "https://openchemref.org",
  "documentation": "https://openchemref.org/docs",
  "categories": ["chemistry", "other"],
  "primary_category": "reference",
  "endpoints": [
    {
      "path": "/compounds",
      "method": "GET",
      "description": "Search for chemical compounds by name, formula, or CAS number. Returns detailed molecular data.",
      "parameters": [
        {
          "name": "query",
          "type": "string",
          "required": true,
          "description": "Search term: compound name, molecular formula, or CAS registry number."
        }
      ],
      "response_description": "Array of matching compounds with molecular weight, formula, CAS number, and physical properties."
    },
    {
      "path": "/compounds/{id}",
      "method": "GET",
      "description": "Retrieve detailed data for a specific compound by its internal identifier.",
      "parameters": [
        {
          "name": "id",
          "type": "string",
          "required": true,
          "description": "The compound's unique identifier."
        }
      ],
      "response_description": "Full compound record including synonyms, hazard data, solubility, and spectral references."
    }
  ],
  "authentication": {
    "required": false,
    "type": "none"
  },
  "pricing": {
    "model": "free",
    "free_tier": {
      "queries_per_day": 10000,
      "queries_per_month": null
    },
    "paid_tier": null
  },
  "payment": null,
  "rate_limits": {
    "requests_per_minute": 120,
    "requests_per_day": 10000
  },
  "reliability": {
    "uptime_percentage": 99.5,
    "avg_response_time_ms": 85
  },
  "agent_notes": "This API is completely free and requires no account, authentication, or payment. All responses include a 'meta' object with field descriptions. Rate limit is 120 requests per minute and 10,000 per day. If you exceed the rate limit, wait 60 seconds before retrying. Use the /compounds endpoint for search and /compounds/{id} for detailed lookup. Pricing: free for all usage within rate limits.",
  "contact": "support@openchemref.org",
  "listing_requested": true,
  "last_updated": "2026-02-19T00:00:00Z"
}
```

### 21.2 Per-Request Metered API

```json
{
  "spec_version": "agentmanifest-0.3",
  "name": "GeoInsight Enrichment API",
  "version": "3.0.0",
  "description": "Real-time geospatial enrichment API providing property data, zoning information, flood risk scores, and demographic overlays for any US address or coordinate pair. Updated weekly from authoritative government sources.",
  "homepage": "https://geoinsight.io",
  "documentation": "https://geoinsight.io/docs",
  "categories": ["geography", "finance"],
  "primary_category": "enrichment",
  "endpoints": [
    {
      "path": "/enrich",
      "method": "POST",
      "description": "Enrich an address or coordinate with property, zoning, risk, and demographic data.",
      "parameters": [
        {
          "name": "address",
          "type": "string",
          "required": false,
          "description": "A US street address. Either address or coordinates must be provided."
        },
        {
          "name": "lat",
          "type": "number",
          "required": false,
          "description": "Latitude. Required if address is not provided."
        },
        {
          "name": "lon",
          "type": "number",
          "required": false,
          "description": "Longitude. Required if address is not provided."
        }
      ],
      "response_description": "Enrichment result with property value estimate, zoning class, flood zone, and census tract demographics.",
      "cost_hint": {
        "unit": "request",
        "estimated_price": "0.05",
        "currency": "USD"
      }
    }
  ],
  "authentication": {
    "required": true,
    "type": "api_key",
    "instructions": "Obtain an API key via the AMP payment onboarding flow. Include the key in the X-API-Key header.",
    "config": {
      "header": "X-API-Key"
    }
  },
  "pricing": {
    "model": "usage_based",
    "free_tier": null,
    "paid_tier": {
      "amount_usd": 0.05,
      "unit": "request",
      "description": "$0.05 per enrichment request."
    }
  },
  "payment": {
    "model": "per_request",
    "currency": "USD",
    "rates": [
      {
        "unit": "request",
        "price": "0.05",
        "description": "Per enrichment request"
      }
    ],
    "onboarding": {
      "url": "https://geoinsight.io/amp/onboard",
      "method": "POST",
      "accepts": ["signed_jwt", "platform_token"],
      "returns": {
        "credential_type": "api_key",
        "credential_field": "api_key",
        "instructions": "Include the returned API key in the X-API-Key header on all requests.",
        "expires_in": null
      }
    },
    "usage_endpoint": {
      "url": "https://geoinsight.io/amp/usage",
      "method": "GET",
      "authentication": "same_as_api"
    },
    "settlement": {
      "type": "real_time",
      "cycle": null
    },
    "budget_controls": {
      "supports_spend_cap": true,
      "supports_per_request_limit": false,
      "supports_rate_limit": true
    }
  },
  "rate_limits": {
    "requests_per_minute": 60,
    "requests_per_day": 50000
  },
  "reliability": {
    "uptime_percentage": 99.9,
    "avg_response_time_ms": 220
  },
  "agent_notes": "To use this API, complete AMP payment onboarding by POSTing your agent payment credential to /amp/onboard. The onboarding flow returns an API key. Include this key in the X-API-Key header. Each request costs $0.05 USD, settled in real time. Budget controls support spend caps — declare your cap during onboarding. Check your usage at /amp/usage. Authentication is via API key. Pricing is per-request at $0.05. If budget is exceeded, you will receive a 402 response with resolution instructions.",
  "contact": "api-support@geoinsight.io",
  "listing_requested": true,
  "last_updated": "2026-02-19T00:00:00Z"
}
```

### 21.3 Prepaid Credits API

```json
{
  "spec_version": "agentmanifest-0.3",
  "name": "LegalSearch Pro",
  "version": "1.4.0",
  "description": "Full-text search across 12 million US court opinions, statutes, and regulations. Returns relevant passages with citations and cross-references. Designed for AI legal research assistants with structured response metadata.",
  "homepage": "https://legalsearchpro.com",
  "documentation": "https://legalsearchpro.com/api-docs",
  "categories": ["legal"],
  "primary_category": "legal",
  "endpoints": [
    {
      "path": "/search",
      "method": "POST",
      "description": "Search court opinions and statutes by natural language query or citation. Returns ranked results with relevance scores.",
      "parameters": [
        {
          "name": "query",
          "type": "string",
          "required": true,
          "description": "Natural language search query or legal citation."
        },
        {
          "name": "jurisdiction",
          "type": "string",
          "required": false,
          "description": "Limit to a specific jurisdiction (e.g., 'federal', 'CA', 'NY')."
        },
        {
          "name": "limit",
          "type": "integer",
          "required": false,
          "description": "Max results to return. Default: 10, Max: 100."
        }
      ],
      "response_description": "Array of matching legal documents with titles, citations, relevant passages, and cross-references.",
      "cost_hint": {
        "unit": "query",
        "estimated_price": "0.10",
        "currency": "USD",
        "notes": "Cost varies by result count: $0.10 base + $0.01 per result returned."
      }
    }
  ],
  "authentication": {
    "required": true,
    "type": "api_key",
    "instructions": "Obtain an API key through AMP payment onboarding. Include it in the Authorization header as 'Bearer {key}'.",
    "config": {
      "header": "Authorization",
      "scheme": "Bearer"
    }
  },
  "pricing": {
    "model": "usage_based",
    "free_tier": null,
    "paid_tier": {
      "amount_usd": 0.10,
      "unit": "query",
      "description": "$0.10 per query base cost, plus $0.01 per result."
    }
  },
  "payment": {
    "model": "prepaid_credits",
    "currency": "USD",
    "rates": [
      {
        "unit": "query",
        "price": "0.10",
        "description": "Base cost per search query"
      },
      {
        "unit": "result",
        "price": "0.01",
        "description": "Per result returned beyond base query cost"
      }
    ],
    "onboarding": {
      "url": "https://legalsearchpro.com/amp/onboard",
      "method": "POST",
      "accepts": ["signed_jwt", "platform_token", "oauth_bearer"],
      "returns": {
        "credential_type": "bearer_token",
        "credential_field": "access_token",
        "instructions": "Include the token in the Authorization header as 'Bearer {token}'.",
        "expires_in": 2592000,
        "refresh_url": "https://legalsearchpro.com/amp/refresh"
      }
    },
    "usage_endpoint": {
      "url": "https://legalsearchpro.com/amp/usage",
      "method": "GET",
      "authentication": "same_as_api"
    },
    "settlement": {
      "type": "prepaid_debit",
      "cycle": null
    },
    "budget_controls": {
      "supports_spend_cap": true,
      "supports_per_request_limit": true,
      "supports_rate_limit": true,
      "supports_alerting": true
    },
    "refund_policy": {
      "type": "credit",
      "terms_url": "https://legalsearchpro.com/refund-policy",
      "window_seconds": 86400
    }
  },
  "rate_limits": {
    "requests_per_minute": 30,
    "requests_per_day": 5000
  },
  "reliability": {
    "uptime_percentage": 99.95,
    "avg_response_time_ms": 450
  },
  "agent_notes": "This API uses prepaid credits. Complete payment onboarding at /amp/onboard with your agent credential; the initial credit purchase amount is specified in your spend cap. Credits are debited per query ($0.10 base) and per result ($0.01 each). Check your credit balance at /amp/usage. When credits are exhausted you will receive a 402 response with a topup URL. Authentication is via Bearer token in the Authorization header. Pricing is prepaid credit-based. Budget controls include spend caps, per-request limits, and alerting. Token expires after 30 days — use /amp/refresh to renew.",
  "contact": {
    "email": "api@legalsearchpro.com",
    "support_url": "https://legalsearchpro.com/support"
  },
  "listing_requested": true,
  "last_updated": "2026-02-19T00:00:00Z"
}
```

### 21.4 Subscription-Based API

```json
{
  "spec_version": "agentmanifest-0.3",
  "name": "MarketPulse Financial Data",
  "version": "5.2.0",
  "description": "Real-time and historical financial market data covering equities, bonds, forex, and commodities across 60 global exchanges. Includes fundamentals, technicals, and sentiment indicators. Data latency under 500ms for real-time feeds.",
  "homepage": "https://marketpulse.io",
  "documentation": "https://marketpulse.io/docs/api",
  "categories": ["finance"],
  "primary_category": "live",
  "endpoints": [
    {
      "path": "/quotes",
      "method": "GET",
      "description": "Get real-time or delayed quotes for one or more symbols across any supported exchange.",
      "parameters": [
        {
          "name": "symbols",
          "type": "string",
          "required": true,
          "description": "Comma-separated ticker symbols (e.g., 'AAPL,MSFT,GOOG')."
        }
      ],
      "response_description": "Array of quote objects with bid, ask, last price, volume, and timestamp for each symbol."
    },
    {
      "path": "/history",
      "method": "GET",
      "description": "Retrieve historical OHLCV data for a symbol with configurable time resolution.",
      "parameters": [
        {
          "name": "symbol",
          "type": "string",
          "required": true,
          "description": "Ticker symbol."
        },
        {
          "name": "interval",
          "type": "string",
          "required": false,
          "description": "Time interval: '1m', '5m', '1h', '1d', '1w'. Default: '1d'."
        },
        {
          "name": "from",
          "type": "string",
          "required": false,
          "description": "Start date (ISO 8601)."
        },
        {
          "name": "to",
          "type": "string",
          "required": false,
          "description": "End date (ISO 8601)."
        }
      ],
      "response_description": "Array of OHLCV candles with open, high, low, close, volume, and timestamp."
    }
  ],
  "authentication": {
    "required": true,
    "type": "api_key",
    "instructions": "Obtain an API key through AMP payment onboarding. Include it in the X-API-Key header.",
    "config": {
      "header": "X-API-Key"
    }
  },
  "pricing": {
    "model": "subscription",
    "free_tier": null,
    "paid_tier": {
      "amount_usd": 99.00,
      "unit": "month",
      "description": "$99/month for up to 100,000 requests. Includes real-time data for US equities."
    }
  },
  "payment": {
    "model": "subscription",
    "currency": "USD",
    "rates": [
      {
        "unit": "month",
        "price": "99.00",
        "tier": "standard",
        "description": "Standard plan: up to 100,000 requests/month, US equities real-time."
      },
      {
        "unit": "month",
        "price": "299.00",
        "tier": "professional",
        "description": "Professional plan: up to 1,000,000 requests/month, all exchanges real-time."
      }
    ],
    "onboarding": {
      "url": "https://marketpulse.io/amp/onboard",
      "method": "POST",
      "accepts": ["signed_jwt", "platform_token"],
      "returns": {
        "credential_type": "api_key",
        "credential_field": "api_key",
        "instructions": "Include the returned API key in the X-API-Key header.",
        "expires_in": null
      }
    },
    "usage_endpoint": {
      "url": "https://marketpulse.io/amp/usage",
      "method": "GET",
      "authentication": "same_as_api"
    },
    "settlement": {
      "type": "postpaid_cycle",
      "cycle": "monthly",
      "provider_name": null,
      "provider_url": null
    },
    "budget_controls": {
      "supports_spend_cap": false,
      "supports_per_request_limit": false,
      "supports_rate_limit": true
    }
  },
  "rate_limits": {
    "requests_per_minute": 300,
    "requests_per_day": null
  },
  "reliability": {
    "uptime_percentage": 99.99,
    "avg_response_time_ms": 45
  },
  "agent_notes": "This API requires a monthly subscription. Complete payment onboarding at /amp/onboard — specify your preferred tier ('standard' at $99/mo or 'professional' at $299/mo) in the requested_plan. The onboarding flow returns an API key. Authentication is via X-API-Key header. Pricing is subscription-based, billed monthly. Rate limit is 300 requests/minute. Check usage at /amp/usage. If your subscription expires, you will receive a 402 response with renewal instructions. Budget controls: rate limiting only, no spend caps (subscription is fixed cost).",
  "contact": "api@marketpulse.io",
  "listing_requested": true,
  "last_updated": "2026-02-19T00:00:00Z"
}
```

### 21.5 Tiered/Volume Pricing API

```json
{
  "spec_version": "agentmanifest-0.3",
  "name": "TranslateEngine",
  "version": "4.0.0",
  "description": "Neural machine translation API supporting 120 language pairs with domain-specific models for legal, medical, and technical content. Accepts text, HTML, and structured documents. Returns translations with confidence scores and alternative suggestions.",
  "homepage": "https://translateengine.com",
  "documentation": "https://translateengine.com/api",
  "categories": ["translation", "other"],
  "primary_category": "computational",
  "endpoints": [
    {
      "path": "/translate",
      "method": "POST",
      "description": "Translate text or structured content between any of 120 supported language pairs.",
      "parameters": [
        {
          "name": "text",
          "type": "string",
          "required": true,
          "description": "The text to translate. Maximum 10,000 characters per request."
        },
        {
          "name": "source_lang",
          "type": "string",
          "required": false,
          "description": "Source language code (ISO 639-1). Auto-detected if omitted."
        },
        {
          "name": "target_lang",
          "type": "string",
          "required": true,
          "description": "Target language code (ISO 639-1)."
        },
        {
          "name": "domain",
          "type": "string",
          "required": false,
          "description": "Domain-specific model: 'general', 'legal', 'medical', 'technical'. Default: 'general'."
        }
      ],
      "response_description": "Translation result with translated text, detected source language, confidence score, and alternative translations.",
      "cost_hint": {
        "unit": "token",
        "estimated_price": "0.00002",
        "currency": "USD",
        "notes": "Approximately 1 token per word. Domain-specific models cost the same."
      }
    }
  ],
  "authentication": {
    "required": true,
    "type": "api_key",
    "instructions": "Obtain an API key through AMP payment onboarding. Include in the X-API-Key header.",
    "config": {
      "header": "X-API-Key"
    }
  },
  "pricing": {
    "model": "tiered",
    "free_tier": null,
    "paid_tier": {
      "amount_usd": 0.00002,
      "unit": "token",
      "description": "Starting at $0.00002/token with volume discounts."
    }
  },
  "payment": {
    "model": "metered_usage",
    "currency": "USD",
    "rates": [
      {
        "unit": "token",
        "price": "0.00002",
        "tier": "standard",
        "threshold": 0,
        "cap": 1000000,
        "description": "First 1M tokens per month at $0.00002/token ($20 per 1M tokens)"
      },
      {
        "unit": "token",
        "price": "0.000015",
        "tier": "high_volume",
        "threshold": 1000001,
        "cap": 10000000,
        "description": "1M–10M tokens per month at $0.000015/token ($15 per 1M tokens)"
      },
      {
        "unit": "token",
        "price": "0.00001",
        "tier": "enterprise",
        "threshold": 10000001,
        "cap": null,
        "description": "Beyond 10M tokens per month at $0.00001/token ($10 per 1M tokens)"
      }
    ],
    "onboarding": {
      "url": "https://translateengine.com/amp/onboard",
      "method": "POST",
      "accepts": ["signed_jwt", "platform_token", "oauth_bearer"],
      "returns": {
        "credential_type": "api_key",
        "credential_field": "api_key",
        "instructions": "Include the returned API key in the X-API-Key header.",
        "expires_in": null
      }
    },
    "usage_endpoint": {
      "url": "https://translateengine.com/amp/usage",
      "method": "GET",
      "authentication": "same_as_api"
    },
    "settlement": {
      "type": "postpaid_cycle",
      "cycle": "monthly"
    },
    "budget_controls": {
      "supports_spend_cap": true,
      "supports_per_request_limit": true,
      "supports_rate_limit": true,
      "supports_alerting": true
    },
    "refund_policy": {
      "type": "none"
    }
  },
  "rate_limits": {
    "requests_per_minute": 200,
    "requests_per_day": null
  },
  "reliability": {
    "uptime_percentage": 99.9,
    "avg_response_time_ms": 180
  },
  "agent_notes": "Complete payment onboarding at /amp/onboard to receive your API key. Authentication is via X-API-Key header. Pricing uses tiered volume rates: $20/M tokens up to 1M, $15/M from 1-10M, $10/M above 10M. Roughly 1 token per word. Settlement is monthly postpaid. Budget controls support spend caps, per-request limits, and threshold alerting. Specify your spend cap during onboarding. The X-AMP-Request-Cost header on each response shows actual token cost. Check accumulated usage at /amp/usage.",
  "contact": {
    "email": "api@translateengine.com",
    "support_url": "https://translateengine.com/support"
  },
  "listing_requested": true,
  "last_updated": "2026-02-19T00:00:00Z"
}
```

---

## 22. Changelog: v0.2 → v0.3

### Added

- **§10 Payment Object.** New top-level `payment` field declaring machine-executable payment contracts. Supports five payment models: `free`, `per_request`, `metered_usage`, `prepaid_credits`, `subscription`.
- **§11 Agent Payment Credentials.** Schema for agent spending authorization, including principal identification, budget limits, credential scoping, and two verification methods (signature and issuer callback).
- **§12 Payment Onboarding Flow.** Formal step-by-step protocol for autonomous billing relationship establishment, including error handling and retry policy.
- **§13 Budget Enforcement Headers.** Standard HTTP headers (`X-AMP-Budget-Limit`, `X-AMP-Budget-Spent`, `X-AMP-Budget-Remaining`, `X-AMP-Request-Cost`, `X-AMP-Cost-Estimate`) for real-time budget communication.
- **§14 The 402 Payment Required Response.** Structured error response schema enabling agents to programmatically understand and resolve payment issues.
- **§7.2 Endpoint Cost Hint.** Optional per-endpoint cost metadata for APIs with variable pricing.
- **§20 Security Considerations.** Expanded section covering credential replay prevention, scoping, rotation, budget enforcement, trust model, and transport security.
- **§19.2 Registry Discovery.** New query parameters for filtering by payment model, price, currency, and budget controls.
- **§18.2 Payment Validation Checks.** Ten new validation checks for the payment block.
- **Registry Badge: `budget-aware`.** New badge for APIs that return budget enforcement headers.

### Changed

- **`spec_version`**: `"agentmanifest-0.2"` → `"agentmanifest-0.3"`.
- **`agent_notes` minimum length**: Increased from 50 to 150 characters (aligning with operational completeness requirements).
- **§17 Agent Operational Completeness**: Extended to recommend payment/onboarding references for paid APIs.

### Unchanged

- All v0.2 fields retain their semantics and remain valid.
- The `pricing` block is unchanged and continues to serve as the informational summary.
- Authentication, endpoint, categorization, and reliability schemas are unchanged.

---

## 23. Migration Guide: v0.2 → v0.3

### For Free APIs (No Changes Required)

If your API is free:

1. Update `spec_version` to `"agentmanifest-0.3"`.
2. Ensure `agent_notes` is at least 150 characters (increased from v0.2).
3. Optionally add `"payment": null` for explicitness. Omitting `payment` is equally valid.
4. No other changes needed.

### For Paid APIs (Adding Payment Support)

1. Update `spec_version` to `"agentmanifest-0.3"`.
2. Keep your existing `pricing` block unchanged for backward compatibility.
3. Add a `payment` block describing your machine-executable payment contract:
   - Choose your `model` (`per_request`, `metered_usage`, `prepaid_credits`, `subscription`).
   - Define `rates` with decimal string prices.
   - Implement and declare an `onboarding` endpoint.
   - Choose a `settlement` type.
   - Declare `budget_controls` your API supports.
4. Implement the onboarding endpoint (§12):
   - Accept `agent_payment_credential` in the request body.
   - Verify credentials via signature check or issuer callback (§11.3).
   - Return an access credential on success.
5. Add budget enforcement headers to your API responses (§13):
   - `X-AMP-Request-Cost` on every response (REQUIRED for paid APIs).
   - `X-AMP-Budget-Spent` and `X-AMP-Budget-Remaining` (RECOMMENDED).
6. Implement 402 responses for budget/payment failures (§14).
7. Optionally implement a usage endpoint.
8. Update `agent_notes` to reference the payment onboarding flow (minimum 150 characters).
9. Re-validate your manifest using the AMP validator.

### For v0.2 Consumers (Reading v0.3 Manifests)

v0.3 manifests are backward compatible. v0.2 consumers:

- Will successfully parse all v0.2 fields.
- MUST ignore unrecognized fields (including `payment`).
- Will continue to use the `pricing` block for informational cost data.
- Will not be able to perform autonomous payment onboarding.

To gain v0.3 payment capabilities, consumers should:

1. Parse the `payment` block when present.
2. Implement credential presentation (§11).
3. Implement the onboarding flow (§12).
4. Implement budget header handling (§13).
5. Implement 402 response handling (§14).

---

*This specification is released under [CC0 1.0 Universal](https://creativecommons.org/publicdomain/zero/1.0/) — public domain dedication.*
